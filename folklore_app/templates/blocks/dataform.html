<div class="w3-container">
  <div id="search_tabs" class="search-form w3-bar w3-white">
    <button class="w3-bar-item w3-button" onclick="openSearch('simple_search')">Простой поиск</button>
    <!-- <button class="w3-bar-item w3-button" onclick="openSearch('complex_search')">Расширенный поиск</button> -->
  </div>


  <div id="simple_search" class="search-block">
    <h2 class="search-h2">Простой поиск</h2>
    <div class="container">
      <form action="{{prefix}}/results" target="_blank">

        <div class="dataform-block-label row">
          <label>Характеристики текста</label>
        </div>

        <div class="row">
          <div>
            <div class="col-md-1">
              <label>Год</label>
              <input type="number" id="year_from" name="year_from" placeholder="с">
            </div>
            <div class="col-md-1">
              <label>_</label>
              <input type="number" id="year_to" name="year_to" placeholder="по">
            </div>
          </div>

          <div class="col-md-3">
            <label for="keywords" >Ключевые слова</label>
            <select id="keywords" name="keywords" multiple size=1>
              {% for i in selection['keywords'] %}
                <option value="{{i}}">{{i}}</option>
              {% endfor %}
            </select>
          </div>
        </div>

        <div class="row">
          <label class="dataform-block-label">Место сбора данных</label>
        </div>

        <div class="row">
          <div class="col-md-4">
            <label for="region">Область</label>
            <select name="region" id="region" onchange="_1sel_geo_text();" multiple></select>
          </div>

          <div class="col-md-4">
            <label for="district">Район</label>
            <select name="district" id="district" onchange="_2sel_geo_text();" multiple></select>
          </div>

          <div class="col-md-4">
            <label for="village">Населенный пункт</label>
            <select name="village" id="village" multiple></select>
          </div>
        </div>

        <div class="row">
          <label class="dataform-block-label">Данные об информанте</label>
        </div>

        <div class="row">

          <div class="col-md-2">
            <label for="gender">Гендер</label>
            <select id="gender" name="gender" size=1>
              <option value="">---</option>
              <option value="m">m</option>
              <option value="f">f</option>
            </select>
          </div>

          <div>
            <div class="col-md-3">
              <label>Год рождения</label>
              <input type="number" id="birth_year_from" name="birth_year_from" placeholder="с">
            </div>
            <div class="col-md-3">
              <label>_</label>
              <input type="number" id="birth_year_to" name="birth_year_to" placeholder="по">
            </div>
          </div>
        </div>

        <input type="submit" name="submit" value="Поиск">
        <input type="submit" name="download" value="Скачать">
      </form>
    </div>
  </div>

  <div id="complex_search" class="search-block" style="display:none">
    <h2 class="search-h2">Расширенный поиск</h2>
    <div class="container">
      <form action="{{prefix}}/results" target="_blank">

        <div class="dataform-block-label row">
          <label>Характеристики текста</label>
        </div>

        <div class="row">
          <div class="col-md-2">
            <label>ID</label>
            <input type="number" id="new_id" name="new_id" placeholder="ID">
          </div>
          {% if current_user.is_authenticated %}
          <div class="col-md-2">
            <label>Прежний ID</label>
            <input type="text" id="old_id" name="old_id" placeholder="Прежний ID">
          </div>
          {% endif %}
          <div>
            <div class="col-md-1">
              <label>Год</label>
              <input type="number" id="year_from" name="year_from" placeholder="с">
            </div>
            <div class="col-md-1">
              <label>_</label>
              <input type="number" id="year_to" name="year_to" placeholder="по">
            </div>
          </div>

          <div class="col-md-3">
            <label for="keywords" >Ключевые слова</label>
            <select id="keywords" name="keywords" multiple size=1>
              {% for i in selection['keywords'] %}
                <option value="{{i}}">{{i}}</option>
              {% endfor %}
            </select>
          </div>

          <div class="col-md-1">
            <label for="question_list" >Программа</label>
            <select id="question_list" name="question_list" multiple size=1>
              {% for i in selection['question_list'] %}
                <option value="{{i}}">{{i}}</option>
              {% endfor %}
            </select>
          </div>

          <div class="col-md-1">
            <label for="question_num">Вопрос</label>
            <select id="question_num" name="question_num" multiple size=1>
              {% for i in selection['question_num'] %}
                <option value="{{i}}">{{i}}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-1">
            <label for="question_letter">Подвопрос</label>
            <select id="question_letter" name="question_letter" multiple size=1>
              {% for i in selection['question_letter'] %}
                <option value="{{i}}">{{i}}</option>
              {% endfor %}
            </select>
          </div>
        </div>

        <div class="row">
          <label class="dataform-block-label">Место сбора данных</label>
        </div>

        <div class="row">
          <div class="col-md-4">
            <label for="region">Область</label>
            <select name="region" id="region" onchange="_1sel_geo_text();" multiple></select>
          </div>

          <div class="col-md-4">
            <label for="district">Район</label>
            <select name="district" id="district" onchange="_2sel_geo_text();" multiple></select>
          </div>

          <div class="col-md-4">
            <label for="village">Населенный пункт</label>
            <select name="village" id="village" multiple></select>
          </div>
        </div>

        <div class="row">
          <label class="dataform-block-label">Данные об информанте</label>
        </div>

        <div class="row">
          <div class="col-md-4">
            <label for="code">Код информанта</label>
            <select id="code" name="code" multiple size=1>
              {% for i in selection['code'] %}
                <option value="{{i}}">{{i}}</option>
              {% endfor %}
            </select>
          </div>

          <div class="col-md-2">
            <label for="gender">Гендер</label>
            <select id="gender" name="gender" size=1>
              <option value="">---</option>
              <option value="m">m</option>
              <option value="f">f</option>
            </select>
          </div>

          <div>
            <div class="col-md-3">
              <label>Год рождения</label>
              <input type="number" id="birth_year_from" name="birth_year_from" placeholder="с">
            </div>
            <div class="col-md-3">
              <label>_</label>
              <input type="number" id="birth_year_to" name="birth_year_to" placeholder="по">
            </div>
          </div>
        </div>

        <div class="row">
          <label class="dataform-block-label">Текущее место жительства информанта</label>
        </div>

        <div class="row">
          <div class="col-md-4">
            <label for="current_region">Область</label>
            <select id="current_region" name="current_region" multiple size=1>
              {% for i in selection['current_region'] %}
                <option value="{{i}}">{{i}}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-4">
            <label for="current_district">Район</label>
            <select id="current_district" name="current_district" multiple size=1>
              {% for i in selection['current_district'] %}
                <option value="{{i}}">{{i}}</option>
              {% endfor %}
            </select>
            </select>
          </div>
          <div class="col-md-4">
            <label for="current_village">Населенный пункт</label>
            <select id="current_village" name="current_village" multiple size=1>
              {% for i in selection['current_village'] %}
                <option value="{{i}}">{{i}}</option>
              {% endfor %}
            </select>
            </select>
          </div>
        </div>

        <div class="row">
          <label class="dataform-block-label">Место рождения информанта</label>
        </div>

        <div class="row">
          <div class="col-md-4">
            <label for="birth_region">Область</label>
            <select id="birth_region" name="birth_region" multiple size=1>
              {% for i in selection['birth_region'] %}
                <option value="{{i}}">{{i}}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-4">
            <label for="birth_district">Район</label>
            <select id="birth_district" name="birth_district" multiple size=1>
              {% for i in selection['birth_district'] %}
                <option value="{{i}}">{{i}}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-4">
            <label for="birth_village">Населенный пункт</label>
            <select id="birth_village" name="<div class="container" multiple size=1>
              {% for i in selection['birth_village'] %}
                <option value="{{i}}">{{i}}</option>
              {% endfor %}
            </select>
          </div>
        </div>

        <input type="submit" name="submit" value="Поиск">
        <input type="submit" name="download" value="Скачать">
      </form>
    </div>
  </div>
</div>


<script>
function openSearch(blockName) {
  var i;
  var x = document.getElementsByClassName("search-block");
  for (i = 0; i < x.length; i++) {
    x[i].style.display = "none";
  }
  document.getElementById(blockName).style.display = "block";
}
</script>

    <script>
        var geo_text_1 = document.getElementById("region");
        var geo_text_2 = document.getElementById("district");
        var geo_text_3 = document.getElementById("village");
        console.log(geo_text_1)

        var geo_text_dataObj = {{ selection['geo_text']|tojson }};

        let geo_text_ctrs = Object.keys(geo_text_dataObj);
        cmo(geo_text_ctrs, geo_text_1);
        _1sel_geo_text();

        function _1sel_geo_text() {
            geo_text_2.innerHTML = "";//clear the target select
            let districts = Object.keys(geo_text_dataObj[geo_text_1.value]);//get the cities from country as array
            cmo(districts, geo_text_2);
            _2sel_geo_text();
        }

        function _2sel_geo_text() {
            geo_text_3.innerHTML = "";//clear
            let villages = geo_text_dataObj[geo_text_1.value][geo_text_2.value];
            cmo(villages, geo_text_3);
        }

        function cmo(arr, s) {//create options and add to select
            arr.forEach(o => {
                let opt = document.createElement("option");
                opt.value = o;
                opt.innerHTML = o;
                s.add(opt);
            });
        }
    </script>